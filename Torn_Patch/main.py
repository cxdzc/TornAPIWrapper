import requests
from bs4 import BeautifulSoup

get_patchnotes = requests.get(url="https://www.torn.com/apipublic.php?patchNotes=true", headers={"Host": "www.torn.com", "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:147.0) Gecko/20100101 Firefox/147.0", "Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8", "Accept-Language": "en-US,en;q=0.9", "Accept-Encoding": "gzip, deflate, zstd", "DNT": "1", "Connection": "keep-alive", "Cookie": "cf_clearance=lnsK.lvUm8MliLd81ATyJnu.hT7SQrE305d2HhFguXk-1769662531-1.2.1.1-31NTv.Zbsxo6aK7Rl0CH4MQGNPUexuTg8h07nEXhKVQ3kviHICzsPbMcw1rWjenQLwcswYTH2zOj_.yZ3j1ZY_7PB8n6YgZwl5QnujSG0AuCLo1riHJiDZAT8iFjiKPGavyYsZ2Nh8HTRk_vZtReKuExCcgOCrnBd7lZpUrgechppyjHYR5jv8yg_yg3Mx.5lz1m.6XbPB5YHja6arDr_tEmqA4InnXKDVhBz1FQLIONudtmIQjJJpF17lfZcls5; rfc_v=697ad73ac9413; darkModeEnabled=true; newsTickerIsEnabled=true; newsTickerIsEnabled=true; g_state={\"i_l\":0,\"i_ll\":1768542477172,\"i_b\":\"bI+AdaRwQZMYotyr/WeNygrvVwi1ea4wAOrnCaMxlBs\",\"i_e\":{\"enable_itp_optimization\":0}}; secret=6969d111daa086.98840093; uid=3157295; uid=3157295; sso_wiki_token=840f91a6b6b930ea3b24f0c0f2fbae6bc8d4c5b23974c98696fee89270246ce5; sso_wiki_user=AfricanChild; newsTicker={\"activeDonationID\":2,\"activeHeadlineID\":2,\"activeHeadlineType\":\"donation\",\"headlinesLeft\":3}; newsTicker={\"activeDonationID\":2,\"activeHeadlineID\":2,\"activeHeadlineType\":\"donation\",\"headlinesLeft\":3}; at547085a4a23e4b4bcb7e924b97afbd2d=d5821be421744733e0383a1cecc605ec; chatVersion=3; PHPSESSID=257754f307371103a6cbad4a95bad569; isLoggedIn=1; disableHintTooltip_3157295=true; disableHintTooltip_3157295=true; gymTrains={\"speed\":3}; active_tab=1; encodedPosition=; userItemsPreferences=%7B%22userItemsEquippedWeapons%22%3Afalse%2C%22userItemsEquippedArmour%22%3Afalse%2C%22userItemsWeapon%22%3Afalse%2C%22userItemsThumbnails%22%3Afalse%2C%22userItemsActiveTab%22%3A%22all-items%22%7D; selectedSortedBy=owned; tcClockEnabled=true; rfc_id=697ad73ac9413; __cf_bm=HLBTbeLMJEQyFT2hOYTXQ5_m2TH5cJuQVikR3Hscu.s-1769662529-1.0.1.1-a1KyrkBvQNouF_lBF0oNfFeUY8OLB2Hn.HBRwE5n2Nu080wlxRd5b0v8IPnGkckJ07YSwEFnoxFXUbsd0lvaYACuia34YcQkMwl2.3ty3vI; uid_token=1769662667.56ee814b420ea6cca2b1d6e00c63d48d7056eedff12e78b743d4fc70d98d6518; uid_token=1769662651.3e910319ac36bf44fcf4d4db2ee830213bceadee9acb0948a1be1a3da6f17583", "Upgrade-Insecure-Requests": "1", "Sec-Fetch-Dest": "document", "Sec-Fetch-Mode": "navigate", "Sec-Fetch-Site": "none", "Sec-Fetch-User": "?1", "Priority": "u=0, i", "Pragma": "no-cache", "Cache-Control": "no-cache", "TE": "trailers"})
soup = BeautifulSoup(get_patchnotes.content, "html.parser")
patch_date = soup.find("p").text
with open("last_patch_date.txt", "rt") as f:
    if patch_date != f.readline():
        patch_description = soup.find("ul").text
        message = f"""```
{patch_date}
{patch_description}```"""
        post_patchnotes = requests.post(url="https://discord.com/api/webhooks/1466304465698295899/83CXnFcb2rMpYtanMlKC68vRoY8BMFsytDmudolOVb2daKCdW4wYjpCQ4E26SgOogLo6", json={"content": message})
        with open("last_patch_date.txt", "wt") as ff:
            ff.write(patch_date)